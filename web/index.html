<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>K4CG Jitsi Rooms</title>
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<script src="js/jquery-3.5.1.min.js" type='text/javascript'></script>
		<script src="js/bootstrap.min.js"></script>
		<script src='http://localhost:8000/external_api.js'></script>
		<style type='text/css'>
			.container {
				max-width: 4096px;
			}
		</style>	
	</head>
	<body>
		
		<div class="d-flex flex-row h-100" id="main-row">
			<div class="col-sm-1 bg-dark text-light" id="roomlist">
				<button type="button" class="btn btn-primary" onclick="btnclick('room1')">Room1</button>
				<div id="userlist">
				</div>
			</div>
			<div class="d-flex flex-column w-100" id="jitsi">
			</div>
		</div>
		
		<script type="text/javascript">
			var nick = window.prompt("Choose Nick", "");
			var domain = "localhost:8000";
			var options = {
				noSSL: true,
				roomName: "test",
				parentNode: $("#jitsi")[0],
				configOverwrite: {
					//startWithAudioMuted: false
				},
				interfaceConfigOverwrite: {
				},
				userInfo: {
					displayName: nick
				}
			}
			var api = new JitsiMeetExternalAPI(domain, options);
			
			function btnclick(id) {
				api.executeCommand("hangup");
				api.dispose()
				options["roomName"] = id;
				api = new JitsiMeetExternalAPI(domain, options);
			}
			
			function jitsiPoll()
			{
				var users = api.getParticipantsInfo();
				var list = $("#userlist")[0];
				while(list.firstChild)
					list.removeChild(list.firstChild);
				for (let u in users)
				{
					var name = users[u]["displayName"];
					var node = document.createElement("p");
					node.appendChild(document.createTextNode(name));
					list.appendChild(node);
				}
			}
			setInterval(jitsiPoll, 1000);
		</script>
		
	</body>
</html>
